{% extends 'main.html' %}

{% load static %}

{% block content %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suppliers - Smart Pharmacy Management System</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>

<body>
    <div class="dashboard-container">

        <main class="main-content">
            <div class="page-header">
                <h1>Pharmaceutical Suppliers</h1>
                <p>Manage your supplier contacts and information</p>
            </div>

            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
            {% endif %}

            <!-- Suppliers Table -->
            <div class="table-container">
                <div class="table-header">
                    <h2 class="table-title">All Suppliers</h2>
                    <div class="table-actions">
                        <form method="GET" action="" style="display: flex; gap: 10px;">
                            <input type="text" name="search" class="search-box" placeholder="Search by name or email..."
                                value="{{ request.GET.search }}">
                        </form>
                        <button class="btn-add" onclick="openAddSupplierModal()">+ Add Supplier</button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Supplier Name</th>
                            <th>Contact Person</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>City</th>
                            <th>Contract</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="suppliersTableBody">
                        {% for a in all_supp %}
                        <tr>
                            <td>{{ a.Name }}</td>
                            <td>{{ a.Contact }}</td>
                            <td>{{ a.Phone }}</td>
                            <td>{{ a.Email }}</td>
                            <td>{{ a.City }}</td>
                            <td>{{ a.Contract }}</td>
                            <td>
                                <span class="status-badge status-active">Active</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a href="javascript:void(0)" class="btn-edit"
                                        data-url="{% url 'edit_supplier' a.id %}" data-name="{{ a.Name }}"
                                        data-contact="{{ a.Contact }}" data-phone="{{ a.Phone }}"
                                        data-email="{{ a.Email }}" data-city="{{ a.City }}"
                                        data-address="{{ a.Address }}" data-contract="{{ a.Contract|date:'Y-m-d' }}"
                                        onclick="openEditSupplierModal(this)">Edit</a>
                                        <a href="{% url 'delete_supplier' a.id %}" class="btn-delete"
                                        onclick="return confirm('Are you sure you want to delete this supplier?');"
                                        style="text-decoration: none; display: inline-block; line-height: normal;">
                                        Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" class="no-data">No suppliers added yet. Click "Add Supplier" to get started.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal for Adding/Editing Supplier -->
    <div id="supplierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Supplier</h2>
                <button class="close-btn" onclick="closeSupplierModal()">&times;</button>
            </div>

            <div class="modal-body">
                <form id="supplierForm" method="POST" action="{% url 'add_supplier' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="Name">Supplier Name</label>
                        <input type="text" name="Name" id="supplierName" placeholder="e.g., MediPharm Inc." required>
                    </div>

                    <div class="form-group">
                        <label for="Contact">Contact Person</label>
                        <input type="text" name="Contact" id="contactPerson" placeholder="e.g., John Smith" required>
                    </div>

                    <div class="form-group">
                        <label for="Phone">Phone Number</label>
                        <input type="tel" name="Phone" id="supplierPhone" placeholder="+1 (555) 000-0000" required>
                    </div>

                    <div class="form-group">
                        <label for="Email">Email Address</label>
                        <input type="email" name="Email" id="supplierEmail" placeholder="supplier@email.com" required>
                    </div>

                    <div class="form-group">
                        <label for="City">City</label>
                        <input type="text" name="City" id="supplierCity" placeholder="e.g., New York" required>
                    </div>

                    <div class="form-group">
                        <label for="Address">Address</label>
                        <input type="text" name="Address" id="supplierAddress" placeholder="Street address" required>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeSupplierModal()">Cancel</button>
                        <button type="submit" class="btn-submit" id="submitBtn">Save Supplier</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="{% static 'script.js' %}"></script>

    <script>
        function openAddSupplierModal() {
            document.getElementById('supplierModal').classList.add('show');
            document.getElementById('supplierForm').action = "{% url 'add_supplier' %}";
            document.getElementById('modalTitle').innerText = "Add New Supplier";
            document.getElementById('submitBtn').innerText = "Save Supplier";
            document.getElementById('supplierForm').reset();
        }

        function openEditSupplierModal(element) {
            document.getElementById('supplierModal').classList.add('show');
            document.getElementById('supplierForm').action = element.dataset.url;
            document.getElementById('modalTitle').innerText = "Edit Supplier";
            document.getElementById('submitBtn').innerText = "Save Supplier";

            document.getElementById('supplierName').value = element.dataset.name;
            document.getElementById('contactPerson').value = element.dataset.contact;
            document.getElementById('supplierPhone').value = element.dataset.phone;
            document.getElementById('supplierEmail').value = element.dataset.email;
            document.getElementById('supplierCity').value = element.dataset.city;
            document.getElementById('supplierAddress').value = element.dataset.address;
        }

        function closeSupplierModal() {
            document.getElementById('supplierModal').classList.remove('show');
        }
    </script>
</body>

</html>
{% endblock %}